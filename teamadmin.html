<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphura.in - Team Management</title>
  <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
}

/* Dark Mode Styles */
.dark body {
    background-color: #1a1a1a;
    color: #e0e0e0;
}

.dark .sidebar {
    background-color: #2d2d2d;
    border-right-color: #404040;
}

.dark .header {
    background-color: #2d2d2d;
    border-bottom-color: #404040;
}

.dark .sidebar-item {
    color: #b0b0b0;
}

.dark .sidebar-item:hover {
    background-color: #3a3a3a;
}

.dark .sidebar-item.active {
    background-color: #3a1a1a;
    color: #e63946;
}

.dark [style*="background: #fff"],
.dark [style*="background-color: #fff"] {
    background-color: #2d2d2d !important;
}

.dark [style*="color: #333"] {
    color: #e0e0e0 !important;
}

.dark [style*="color: #666"] {
    color: #b0b0b0 !important;
}

.dark [style*="border: 1px solid #e0e0e0"],
.dark [style*="border: 2px solid #e0e0e0"] {
    border-color: #404040 !important;
}

.dark input[type="text"],
.dark input[type="search"],
.dark select {
    background-color: #3a3a3a !important;
    color: #e0e0e0 !important;
    border-color: #404040 !important;
}

        .container {
  display: flex;
            min-height: 100vh;
}

/* Sidebar */
.sidebar {
            width: 250px;
            background-color: #fff;
            border-right: 1px solid #e0e0e0;
            padding: 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-logo {
            padding: 24px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .logo-container {
            display: flex;
  align-items: center;
  gap: 10px;
        }

        .graphura-text {
        }
        
        .dark .graphura-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #e63946 0%, #c1121f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        

        

        

        

        

        

        

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
        }

        .sidebar-item {
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #666;
  cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .sidebar-item:hover {
            background-color: #f5f5f5;
        }

        .sidebar-item.active {
            color: #e63946;
            background-color: #fff5f5;
            border-left: 3px solid #e63946;
        }

        .sidebar-item svg {
            width: 20px;
            height: 20px;
        }

        .sidebar-item.logout {
            margin-top: auto;
            color: #999;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 0;
        }

        /* Header */
        .header {
            background-color: #fff;
            padding: 16px 32px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
            flex: 1;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            min-width: 120px;
        }

        .search-bar {
            flex: 1;
            max-width: 800px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #e63946;
            background-color: #fff;
            box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
        }

        .search-bar svg {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: #999;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-container {
            position: relative;
        }

        .notification-icon {
            width: 24px;
            height: 24px;
  cursor: pointer;
            color: #666;
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background-color: #e63946;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 600;
            min-width: 18px;
            text-align: center;
            display: none;
        }

        .notification-badge.show {
            display: block;
        }

        .notification-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            width: 380px;
            max-height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .notification-dropdown.show {
    display: flex;
        }

        .notification-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .notification-clear {
            background: none;
    border: none;
            color: #e63946;
    font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            padding: 4px 8px;
        }

        .notification-clear:hover {
            text-decoration: underline;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
  cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            gap: 12px;
        }

        .notification-item:hover {
            background-color: #f8f9fa;
        }

        .notification-item.unread {
            background-color: #fff5f5;
        }

        .notification-item.unread:hover {
            background-color: #ffebee;
        }

        .notification-icon-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
  color: white;
            font-weight: 600;
            font-size: 16px;
}

        .notification-content {
  flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .notification-message {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 6px;
        }

        .notification-time {
            color: #999;
            font-size: 12px;
        }

        .notification-empty {
            padding: 40px 20px;
            text-align: center;
            color: #999;
        }

        .notification-empty svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .notification-icon-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .notification-empty {
            padding: 40px 20px;
            text-align: center;
            color: #999;
        }

        .notification-empty svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .user-info {
  display: flex;
  align-items: center;
            gap: 12px;
        }

        .user-details {
            text-align: right;
        }

        .user-name {
            font-weight: 500;
            font-size: 14px;
            color: #333;
        }

        .user-role {
            font-size: 12px;
            color: #999;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
  font-weight: 600;
}

        /* Content Area */
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
        }

        .content {
            padding: 32px;
        }

        .settings-content {
            padding: 0;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .page-header p,
        .page-description {
            color: #666;
            font-size: 16px;
}

/* Cards */
.cards {
  padding-top: 20px;
  display: grid;
  grid-template-columns: repeat(3,1fr);
  gap: 20px;
}

.card {
  background: #fff;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.05);
  transition: transform 0.15s ease-out;
}

.card h3 {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
}

.status {
  font-size: 12px;
  padding: 4px 10px;
  border-radius: 20px;
}

.green {
  background: #e7f8ee;
  color: #2ecc71;
}

.red {
  background: #ffe6e6;
  color: #ff4d4d;
}

.yellow {
  background: #fff3cd;
  color: #f1c40f;
}

.info {
  display: flex;
  justify-content: space-between;
  margin: 20px 0;
}

.circle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  background: #f1f1f1;
}

.circle.green {
  background: #e7f8ee;
  color: #2ecc71;
}

.circle.red {
  background: #ffe6e6;
  color: #ff4d4d;
}

.circle.yellow {
  background: #fff3cd;
  color: #f1c40f;
}

.stats {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  margin-bottom: 10px;
}

.card a {
  color: #ff4d5a;
  font-weight: 600;
  text-decoration: none;
}

/* Modal Styles */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.modal-overlay.hidden {
    display: none;
}

.modal-box {
    background: white;
    width: 100%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

.modal-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    font-size: 20px;
    font-weight: 600;
    color: #333;
}

.modal-header button {
    background: none;
    border: none;
    font-size: 24px;
    color: #666;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-body {
    padding: 24px;
}

.input-field {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 15px;
    margin-bottom: 16px;
    transition: border-color 0.2s;
}

.input-field:focus {
    outline: none;
    border-color: #e63946;
}

.members-list {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 16px;
}

.member-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    margin-bottom: 8px;
    background: #f9f9f9;
}

.member-item:hover {
    background: #f5f5f5;
}

.member-info {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.member-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 14px;
}

.member-details {
    flex: 1;
}

.member-name {
    font-weight: 600;
    color: #333;
    font-size: 14px;
}

.member-email {
    font-size: 12px;
    color: #999;
}

.btn-remove {
    padding: 6px 12px;
    background: #ff4d4d;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
}

.btn-remove:hover {
    background: #e63946;
}

.members-checkbox-container {
    max-height: 200px;
    overflow-y: auto;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 16px;
}

.member-checkbox-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px;
    border-radius: 6px;
    transition: background-color 0.2s;
}

.member-checkbox-item:hover {
    background-color: #f5f5f5;
}

.member-checkbox-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: #e63946;
}

.btn-primary {
    background: #e63946;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: none;
    cursor: pointer;
    font-size: 14px;
}

.btn-secondary {
    background: #fff;
    color: #666;
    border: 1px solid #e0e0e0;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 14px;
}
  </style>
</head>
<body>
    <div class="container">
  <!-- Sidebar -->
  <aside class="sidebar">
            <div class="sidebar-logo">
                <div class="graphura-text">Graphura</div>
            </div>
            <div class="sidebar-nav">
                <a href="admin.html" class="sidebar-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="summaryadmin.html" class="sidebar-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    <span>Projects</span>
                </a>
                <a href="tasksadmin.html" class="sidebar-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                    </svg>
                    <span>Tasks</span>
                </a>
                <a href="billing.html" class="sidebar-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    <span>Billing & Reports</span>
                </a>
                <a href="teamadmin.html" class="sidebar-item active">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span>Teams</span>
                </a>
                <a href="calendaradmin.html" class="sidebar-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span>Calendar</span>
                </a>
                <a href="settingsadmin.html" class="sidebar-item">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span>Settings</span>
                </a>
                <a href="#" class="sidebar-item logout">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    <span>Log Out</span>
                </a>
            </div>
  </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 class="page-title">Teams</h1>
                    <div class="search-bar">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Search teams, members, or projects...">
                    </div>
                </div>
                <div class="header-right">
                    <button id="createTeamBtn" style="padding: 10px 20px; background: #e63946; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; margin-right: 16px;">+ Create Team</button>
                    <div class="notification-container">
                        <svg class="notification-icon" id="notificationIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <span class="notification-badge" id="notificationBadge">0</span>
                        <div class="notification-dropdown" id="notificationDropdown">
                            <div class="notification-header">
                                <h3>Notifications</h3>
                                <button class="notification-clear" id="clearAllNotifications">Clear all</button>
                            </div>
                            <div class="notification-list" id="notificationList">
                                <!-- Notifications will be loaded here -->
                            </div>
                        </div>
                    </div>
                    <div class="user-info">
                        <div class="user-details">
                            <div class="user-name">Admin</div>
                            <div class="user-role">Administrator</div>
                        </div>
                        <div class="user-avatar">AD</div>
                    </div>
                </div>
    </header>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <div class="content dashboard-content" id="dashboardContent">
                    <div class="page-header">
      <h1>Team Overview</h1>
      <p>Monitor performance, workloads, and progress across all departments.</p>
                    </div>

                    <div class="cards" id="teamsContainer">
                        <!-- Teams will be loaded dynamically here -->
    </div>
    </div>
    
    <!-- Create Team Modal -->
    <div id="createTeamModal" class="modal-overlay hidden">
        <div class="modal-box" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Create New Team</h3>
                <button onclick="closeCreateTeamModal()" style="background: none; border: none; font-size: 24px; color: #666; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createTeamForm" onsubmit="handleCreateTeam(event); return false;">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Team Name *</label>
                        <input type="text" id="teamName" required style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;" placeholder="Enter team name">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Team Leader *</label>
                        <select id="teamLeader" required style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                            <option value="">Select a leader</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Description</label>
                        <textarea id="teamDescription" style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 14px; min-height: 80px; resize: vertical;" placeholder="Enter team description (optional)"></textarea>
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 20px;">
                        <button type="button" onclick="closeCreateTeamModal()" class="btn-secondary" style="flex: 1;">Cancel</button>
                        <button type="submit" class="btn-primary" style="flex: 1; background: #e63946;">Create Team</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Manage Team Members Modal -->
    <div id="manageTeamMembersModal" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="manageTeamMembersTitle">Manage Team Members</h3>
                <button onclick="closeManageTeamMembersModal()" style="background: none; border: none; font-size: 24px; color: #666; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <div id="currentMembersList" class="members-list">
                    <!-- Current members will be displayed here -->
                </div>
                
                <div style="border-top: 1px solid #e0e0e0; padding-top: 16px; margin-top: 16px;">
                    <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #333;">Add Existing Members:</h4>
                    <div id="availableMembersContainer" class="members-checkbox-container">
                        <!-- Available members checkboxes will be populated here -->
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid #e0e0e0;">
                        <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #333;">Add New Employee:</h4>
                        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                            <input type="text" id="newEmployeeName" placeholder="Employee Name" style="flex: 1; padding: 10px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <input type="email" id="newEmployeeEmail" placeholder="Email (optional)" style="flex: 1; padding: 10px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                        </div>
                        <button type="button" onclick="addNewEmployee()" style="padding: 10px 20px; background: #e63946; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; width: 100%;">Add Employee</button>
                        <div id="newEmployeesList" style="margin-top: 12px;">
                            <!-- Newly added employees will appear here -->
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 16px;">
                        <button type="button" onclick="closeManageTeamMembersModal()" class="btn-secondary" style="flex: 1;">Cancel</button>
                        <button type="button" onclick="saveTeamMembers()" class="btn-primary" style="flex: 1;">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// Load data from localStorage
let teams = JSON.parse(localStorage.getItem('teams')) || [];
let projects = JSON.parse(localStorage.getItem('projects')) || [];
let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
let users = JSON.parse(localStorage.getItem('users')) || [];

// Reload data function
function reloadData() {
    teams = JSON.parse(localStorage.getItem('teams')) || [];
    projects = JSON.parse(localStorage.getItem('projects')) || [];
    tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    users = JSON.parse(localStorage.getItem('users')) || [];
}

// Create Team Functions
function openCreateTeamModal() {
    const modal = document.getElementById('createTeamModal');
    const leaderSelect = document.getElementById('teamLeader');
    
    // Populate leader dropdown with users who have leader role
    if (leaderSelect) {
        leaderSelect.innerHTML = '<option value="">Select a leader</option>';
        const leaders = users.filter(u => u.role === 'leader');
        leaders.forEach(leader => {
            const option = document.createElement('option');
            option.value = leader.name;
            option.textContent = leader.name;
            leaderSelect.appendChild(option);
        });
        
        // Also add employees as potential leaders (in case admin wants to promote someone)
        const employees = users.filter(u => u.role === 'employee');
        employees.forEach(emp => {
            const option = document.createElement('option');
            option.value = emp.name;
            option.textContent = `${emp.name} (Employee)`;
            leaderSelect.appendChild(option);
        });
    }
    
    if (modal) modal.classList.remove('hidden');
}

function closeCreateTeamModal() {
    const modal = document.getElementById('createTeamModal');
    if (modal) modal.classList.add('hidden');
    const form = document.getElementById('createTeamForm');
    if (form) form.reset();
}

function handleCreateTeam(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim();
    const teamLeader = document.getElementById('teamLeader').value;
    const teamDescription = document.getElementById('teamDescription').value.trim();
    
    if (!teamName || !teamLeader) {
        alert('Please fill in team name and select a leader.');
        return;
    }
    
    // Check if team name already exists
    if (teams.some(t => t.name.toLowerCase() === teamName.toLowerCase())) {
        alert('A team with this name already exists.');
        return;
    }
    
    // Get leader user data
    const leaderUser = users.find(u => u.name === teamLeader);
    
    // Create new team
    const newTeam = {
        id: Date.now(),
        name: teamName,
        description: teamDescription || '',
        leader: teamLeader,
        members: leaderUser ? [{
            name: leaderUser.name,
            email: leaderUser.email,
            role: 'leader'
        }] : [{
            name: teamLeader,
            email: `${teamLeader.toLowerCase().replace(/\s+/g, '.')}@graphura.com`,
            role: 'leader'
        }],
        status: 'Active',
        createdAt: new Date().toISOString()
    };
    
    // If leader is an employee, update their role to leader
    if (leaderUser && leaderUser.role === 'employee') {
        leaderUser.role = 'leader';
        localStorage.setItem('users', JSON.stringify(users));
    }
    
    teams.push(newTeam);
    localStorage.setItem('teams', JSON.stringify(teams));
    
    // Trigger storage event for other tabs
    window.dispatchEvent(new Event('storage'));
    
    // Reload and render
    reloadData();
    renderTeams();
    closeCreateTeamModal();
    
    alert('Team created successfully!');
}

// Render teams dynamically
function renderTeams() {
    const container = document.getElementById('teamsContainer');
    if (!container) return;
    
    if (teams.length === 0) {
        container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">No teams found. Create teams in the Tasks Management page.</div>';
        return;
    }
    
    container.innerHTML = teams.map(team => {
        // Get projects for this team
        const teamProjects = projects.filter(p => p.teamId === team.id);
        // Get tasks for team projects
        const teamTasks = tasks.filter(t => teamProjects.some(p => p.id === t.projectId));
        const completedTasks = teamTasks.filter(t => t.status === 'Completed').length;
        const inProgressTasks = teamTasks.filter(t => t.status === 'In Progress').length;
        const pendingTasks = teamTasks.filter(t => t.status === 'Pending' || !t.status).length;
        const totalTasks = teamTasks.length;
        
        // Calculate completion rate
        const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        
        // Determine status
        let statusClass = 'green';
        let statusText = 'On Track';
        if (completionRate < 50) {
            statusClass = 'red';
            statusText = 'At Risk';
        } else if (completionRate < 80) {
            statusClass = 'yellow';
            statusText = 'Delayed';
        }
        
        // Get member count (including leader)
        const memberCount = team.members ? (team.members.length + (team.leader ? 1 : 0)) : (team.leader ? 1 : 0);
        
        // Get leader initials
        const leaderInitials = team.leader ? team.leader.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase() : 'TL';
        
        return `
            <div class="card" style="transition: transform 0.15s ease-out;" onmouseenter="this.style.transform='scale(1.02)'" onmouseleave="this.style.transform='scale(1)'">
                <h3>${team.name} <span class="status ${statusClass}">${statusText}</span></h3>
                <p>${memberCount} Active Member${memberCount !== 1 ? 's' : ''}</p>

        <div class="info">
          <div>
                        <strong>${team.leader || 'No Leader'}</strong>
            <p>Team Lead</p>
          </div>
                    <div class="circle ${statusClass}">${completionRate}%</div>
        </div>

        <div class="stats">
                    <span>${totalTasks} Total Tasks</span>
                    <span>${teamProjects.length} Projects</span>
        </div>
                
        <div style="display: flex; gap: 8px; margin-top: 12px;">
            <button type="button" onclick="openManageTeamMembers(${team.id})" style="flex: 1; text-align: center; padding: 8px; background: #e63946; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer;">Manage Members</button>
        </div>
        </div>
        `;
    }).join('');
}

// Team Member Management Functions
let currentEditingTeamId = null;
let selectedMembersToAdd = [];

function openManageTeamMembers(teamId) {
    // Convert teamId to number if it's a string (from onclick)
    const numericTeamId = typeof teamId === 'string' ? parseInt(teamId, 10) : teamId;
    currentEditingTeamId = numericTeamId;
    const team = teams.find(t => t.id == numericTeamId); // Use == for type coercion
    if (!team) {
        console.error('Team not found with ID:', numericTeamId);
        return;
    }
    
    // Initialize members array if it doesn't exist
    if (!team.members) {
        team.members = [];
    }
    
    const modal = document.getElementById('manageTeamMembersModal');
    const title = document.getElementById('manageTeamMembersTitle');
    const currentMembersList = document.getElementById('currentMembersList');
    const availableMembersContainer = document.getElementById('availableMembersContainer');
    
    if (title) title.textContent = `Manage Members - ${team.name}`;
    
    // Display current members
    if (currentMembersList) {
        if (team.members.length === 0) {
            currentMembersList.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">No members added yet.</div>';
        } else {
            currentMembersList.innerHTML = team.members.map((member, index) => {
                const memberName = typeof member === 'string' ? member : member.name;
                const memberEmail = typeof member === 'object' ? member.email : '';
                const initials = memberName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                
                return `
                    <div class="member-item">
                        <div class="member-info">
                            <div class="member-avatar">${initials}</div>
                            <div class="member-details">
                                <div class="member-name">${memberName}</div>
                                ${memberEmail ? `<div class="member-email">${memberEmail}</div>` : ''}
                            </div>
                        </div>
                        <button class="btn-remove" onclick="removeTeamMember(${index})">Remove</button>
                    </div>
                `;
            }).join('');
        }
    }
    
    // Populate available members (all users except those already in team and the leader)
    if (availableMembersContainer) {
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const currentMemberNames = team.members.map(m => typeof m === 'string' ? m : m.name);
        const availableUsers = users.filter(u => 
            u.name !== team.leader && 
            !currentMemberNames.includes(u.name) &&
            (u.role === 'employee' || u.role === 'leader')
        );
        
        availableMembersContainer.innerHTML = '';
        if (availableUsers.length === 0) {
            availableMembersContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">No available users to add.</div>';
        } else {
            availableUsers.forEach(user => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'member-checkbox-item';
                checkboxItem.innerHTML = `
                    <input type="checkbox" id="available-member-${user.name}" value="${user.name}" data-email="${user.email || ''}">
                    <label for="available-member-${user.name}" style="cursor: pointer; flex: 1;">
                        <div style="font-weight: 600; color: #333;">${user.name}</div>
                        ${user.email ? `<div style="font-size: 12px; color: #999;">${user.email}</div>` : ''}
                    </label>
                `;
                availableMembersContainer.appendChild(checkboxItem);
            });
        }
    }
    
    selectedMembersToAdd = [];
    newEmployeesToAdd = []; // Reset new employees list
    updateNewEmployeesList(); // Clear the new employees display
    if (modal) modal.classList.remove('hidden');
}

function addNewEmployee() {
    const nameInput = document.getElementById('newEmployeeName');
    const emailInput = document.getElementById('newEmployeeEmail');
    
    if (!nameInput || !nameInput.value.trim()) {
        alert('Please enter an employee name.');
        return;
    }
    
    const name = nameInput.value.trim();
    const email = emailInput.value.trim() || `${name.toLowerCase().replace(/\s+/g, '.')}@graphura.com`;
    
    // Check if already in new employees list
    if (newEmployeesToAdd.some(e => e.name.toLowerCase() === name.toLowerCase())) {
        alert('This employee is already in the list to be added.');
        return;
    }
    
    // Check if already a team member
    const team = teams.find(t => t.id == currentEditingTeamId);
    if (team && team.members) {
        const currentMemberNames = team.members.map(m => typeof m === 'string' ? m : m.name);
        if (currentMemberNames.some(n => n.toLowerCase() === name.toLowerCase())) {
            alert('This employee is already a team member.');
            return;
        }
    }
    
    // Add to new employees list
    newEmployeesToAdd.push({
        name: name,
        email: email,
        role: 'employee'
    });
    
    // Clear inputs
    nameInput.value = '';
    emailInput.value = '';
    
    // Update display
    updateNewEmployeesList();
}

function updateNewEmployeesList() {
    const newEmployeesList = document.getElementById('newEmployeesList');
    if (!newEmployeesList) return;
    
    if (newEmployeesToAdd.length === 0) {
        newEmployeesList.innerHTML = '';
        return;
    }
    
    newEmployeesList.innerHTML = newEmployeesToAdd.map((emp, index) => {
        const initials = emp.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        return `
            <div class="member-item" style="margin-bottom: 8px;">
                <div class="member-info">
                    <div class="member-avatar">${initials}</div>
                    <div class="member-details">
                        <div class="member-name">${emp.name} <span style="font-size: 11px; color: #999; font-weight: normal;">(New)</span></div>
                        <div class="member-email">${emp.email}</div>
                    </div>
                </div>
                <button class="btn-remove" onclick="removeNewEmployee(${index})" style="padding: 6px 12px; background: #ff4d4d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">Remove</button>
            </div>
        `;
    }).join('');
}

function removeNewEmployee(index) {
    newEmployeesToAdd.splice(index, 1);
    updateNewEmployeesList();
}

function removeTeamMember(index) {
    if (!currentEditingTeamId) return;
    const team = teams.find(t => t.id == currentEditingTeamId); // Use == for type coercion
    if (!team || !team.members) return;
    
    team.members.splice(index, 1);
    openManageTeamMembers(currentEditingTeamId); // Refresh the modal
}

function closeManageTeamMembersModal() {
    const modal = document.getElementById('manageTeamMembersModal');
    if (modal) modal.classList.add('hidden');
    currentEditingTeamId = null;
    selectedMembersToAdd = [];
    newEmployeesToAdd = [];
    // Clear new employee inputs
    const nameInput = document.getElementById('newEmployeeName');
    const emailInput = document.getElementById('newEmployeeEmail');
    if (nameInput) nameInput.value = '';
    if (emailInput) emailInput.value = '';
    updateNewEmployeesList();
}

function saveTeamMembers() {
    if (!currentEditingTeamId) {
        console.error('No team ID set for editing');
        return;
    }
    
    // Reload data first to get latest users
    reloadData();
    
    // Find team after reloading data
    const team = teams.find(t => t.id == currentEditingTeamId); // Use == for type coercion
    if (!team) {
        console.error('Team not found with ID:', currentEditingTeamId);
        alert('Error: Team not found. Please try again.');
        return;
    }
    
    // Get selected members to add
    const checkboxes = document.querySelectorAll('#availableMembersContainer input[type="checkbox"]:checked');
    const newMembers = Array.from(checkboxes).map(cb => {
        const name = cb.value;
        const email = cb.getAttribute('data-email');
        const user = users.find(u => u.name === name);
        return { 
            name, 
            email: email || user?.email || `${name.toLowerCase().replace(/\s+/g, '.')}@graphura.com`,
            role: user?.role || 'employee'
        };
    });
    
    // Initialize members array if it doesn't exist
    if (!team.members) team.members = [];
    
    // Ensure leader is in members if not already
    if (team.leader) {
        const leaderInMembers = team.members.some(m => {
            const memberName = typeof m === 'string' ? m : m.name;
            return memberName === team.leader;
        });
        if (!leaderInMembers) {
            const leaderUser = users.find(u => u.name === team.leader);
            team.members.push({
                name: team.leader,
                email: leaderUser?.email || `${team.leader.toLowerCase().replace(/\s+/g, '.')}@graphura.com`,
                role: 'leader'
            });
        }
    }
    
    // Add selected existing members
    newMembers.forEach(newMember => {
        const exists = team.members.some(m => {
            const memberName = typeof m === 'string' ? m : m.name;
            return memberName === newMember.name;
        });
        if (!exists) {
            team.members.push(newMember);
        }
    });
    
    // Add new employees (create user accounts for them)
    newEmployeesToAdd.forEach(newEmp => {
        // Check if user already exists
        let existingUser = users.find(u => u.name.toLowerCase() === newEmp.name.toLowerCase() || u.email === newEmp.email);
        
        if (!existingUser) {
            // Create new user account
            const newUser = {
                id: `employee-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                name: newEmp.name,
                email: newEmp.email,
                password: 'password123', // Default password
                role: 'employee'
            };
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
        }
        
        // Add to team members
        const exists = team.members.some(m => {
            const memberName = typeof m === 'string' ? m : m.name;
            return memberName.toLowerCase() === newEmp.name.toLowerCase();
        });
        if (!exists) {
            team.members.push({
                name: newEmp.name,
                email: newEmp.email,
                role: 'employee'
            });
        }
    });
    
    // Save to localStorage
    localStorage.setItem('teams', JSON.stringify(teams));
    localStorage.setItem('users', JSON.stringify(users)); // Ensure users list is saved (in case new employees were added)
    
    // Trigger storage event for other tabs
    window.dispatchEvent(new Event('storage'));
    
    // Refresh display
    reloadData();
    renderTeams();
    
    // Close modal
    closeManageTeamMembersModal();
    
    alert('Team members updated successfully!');
}


// Logout functionality
const logoutBtn = document.querySelector('.sidebar-item.logout');
if (logoutBtn) {
  logoutBtn.addEventListener('click', function(e) {
    e.preventDefault();
    if (confirm('Do you want to logout?')) {
      localStorage.removeItem('currentUser');
      window.location.href = 'login.html';
    }
  });
}


// Notification system
function loadNotifications() {
    const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    
    if (!currentUser) return;
    
    const userNotifications = currentUser.role === 'admin' 
        ? notifications
        : notifications.filter(n => n.targetRole === currentUser.role || n.targetRole === 'all' || (n.targetUser && n.targetUser === currentUser.name));
    
    userNotifications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    
    const unreadCount = userNotifications.filter(n => !n.read).length;
    const badge = document.getElementById('notificationBadge');
    const notificationList = document.getElementById('notificationList');
    
    if (badge) {
        if (unreadCount > 0) {
            badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
            badge.classList.add('show');
        } else {
            badge.classList.remove('show');
        }
    }
    
    if (notificationList) {
        if (userNotifications.length === 0) {
            notificationList.innerHTML = `
                <div class="notification-empty">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                    <p>No notifications</p>
                </div>
            `;
        } else {
            notificationList.innerHTML = userNotifications.map(notification => {
                const timeAgo = getTimeAgo(new Date(notification.timestamp));
                const initials = notification.from ? notification.from.substring(0, 2).toUpperCase() : 'AD';
                const unreadClass = !notification.read ? 'unread' : '';
                
                return `
                    <div class="notification-item ${unreadClass}" data-id="${notification.id}">
                        <div class="notification-icon-small">${initials}</div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${timeAgo}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            notificationList.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', function() {
                    const id = this.dataset.id;
                    markNotificationAsRead(id);
                });
            });
        }
    }
}

function markNotificationAsRead(id) {
    const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
    const notification = notifications.find(n => n.id === id);
    if (notification && !notification.read) {
        notification.read = true;
        localStorage.setItem('notifications', JSON.stringify(notifications));
        loadNotifications();
    }
}

function clearAllNotifications() {
    const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (!currentUser) return;
    
    const updated = currentUser.role === 'admin'
        ? notifications.map(n => ({ ...n, read: true }))
        : notifications.map(n => {
            if (n.targetRole === currentUser.role || n.targetRole === 'all' || (n.targetUser && n.targetUser === currentUser.name)) {
                return { ...n, read: true };
            }
            return n;
        });
    
    localStorage.setItem('notifications', JSON.stringify(updated));
    loadNotifications();
}

function getTimeAgo(date) {
    const now = new Date();
    const diff = now - date;
    const seconds = Math.floor(diff / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    
    if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
    if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
    if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
    return 'Just now';
}

// Search functionality
function performTeamAdminSearch(searchTerm) {
    const teamCards = document.querySelectorAll('.team-card, .card');
    let hasMatches = false;
    
    document.querySelectorAll('.no-results-message').forEach(msg => msg.remove());
    
    if (!searchTerm) {
        teamCards.forEach(card => card.style.display = '');
        return;
    }
    
    teamCards.forEach(card => {
        const cardText = card.textContent.toLowerCase();
        const matches = cardText.includes(searchTerm);
        card.style.display = matches ? '' : 'none';
        if (matches) hasMatches = true;
    });
    
    if (!hasMatches && searchTerm) {
        const content = document.querySelector('.content, .dashboard-content, .teams-grid');
        if (content) {
            const noResults = document.createElement('div');
            noResults.className = 'no-results-message';
            noResults.style.cssText = 'text-align: center; padding: 60px 20px; background: white; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-top: 32px;';
            noResults.innerHTML = `
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 64px; height: 64px; color: #ccc; margin: 0 auto 16px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <h3 style="font-size: 18px; font-weight: 600; color: #666; margin-bottom: 8px;">No results found</h3>
                <p style="font-size: 14px; color: #999;">Try adjusting your search terms</p>
            `;
            content.appendChild(noResults);
        }
    }
}

// Load and apply settings (dark mode, etc.)
function loadSettings() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (!currentUser) return;
    const role = currentUser.role;
    const settingsKey = 'settings_' + role;
    const settings = JSON.parse(localStorage.getItem(settingsKey) || '{}');
    if (settings.darkMode) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
}
loadSettings();
window.addEventListener('storage', function(e) {
    if (e.key && e.key.startsWith('settings_')) loadSettings();
});
window.addEventListener('settingsUpdated', loadSettings);

// Initialize teams on page load
document.addEventListener('DOMContentLoaded', function() {
    // Create Team button
    const createTeamBtn = document.getElementById('createTeamBtn');
    if (createTeamBtn) {
        createTeamBtn.addEventListener('click', openCreateTeamModal);
    }
    
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            performTeamAdminSearch(searchTerm);
        });
    }
    
    reloadData();
    renderTeams();
    
    // Load notifications
    loadNotifications();
    
    // Notification icon click handler
    const notificationIcon = document.getElementById('notificationIcon');
    const notificationDropdown = document.getElementById('notificationDropdown');
    const clearBtn = document.getElementById('clearAllNotifications');
    
    if (notificationIcon && notificationDropdown) {
        notificationIcon.addEventListener('click', function(e) {
            e.stopPropagation();
            notificationDropdown.classList.toggle('show');
            loadNotifications();
        });
        
        document.addEventListener('click', function(e) {
            if (!notificationIcon.contains(e.target) && !notificationDropdown.contains(e.target)) {
                notificationDropdown.classList.remove('show');
            }
        });
    }
    
    if (clearBtn) {
        clearBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            clearAllNotifications();
        });
    }
    
    // Listen for storage changes (from other tabs/windows)
    window.addEventListener('storage', function(e) {
        if (e.key === 'teams' || e.key === 'projects' || e.key === 'tasks' || !e.key) {
            reloadData();
            renderTeams();
        }
        if (e.key === 'notifications' || !e.key) {
            loadNotifications();
        }
    });
    
    // Also listen for custom events for same-tab updates
    window.addEventListener('localStorageUpdated', function() {
        reloadData();
        renderTeams();
  });
});
</script>
</body>
</html>
